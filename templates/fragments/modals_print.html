{% import 'macros/hidden_args.jinja2' as macros %}
<!-- MODAL DE RENOMMAGE -->
<div class="modal fade" id="editModal_{{ print.id }}" tabindex="-1" aria-labelledby="editModalLabel_{{ print.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{{ url_for('edit_print_name', page=page,search=search, focus_id=print.id) }}">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel_{{ print.id }}">Renommer (Print #{{ print.id }})</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="print_id" value="{{ print.id }}">
{{ macros.render_filtered_args(args) }}
          <div class="mb-3">
            <label for="file_name_{{ print.id }}" class="form-label">Nouveau nom</label>
            <input type="text" class="form-control" name="file_name" id="file_name_{{ print.id }}" value="{{ print.file_name }}">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-primary">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- MODAL DE NOMBRE D'Ã‰LÃ‰MENTS -->
<div class="modal fade" id="editItemsModal_{{ print.id }}" tabindex="-1" aria-labelledby="editItemsModalLabel_{{ print.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{{ url_for('edit_print_items', page=page,search=search, focus_id=print.id) }}">
        <div class="modal-header">
          <h5 class="modal-title" id="editItemsModalLabel_{{ print.id }}">Nombre dâ€™Ã©lÃ©ments (Print #{{ print.id }})</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="print_id" value="{{ print.id }}">
{{ macros.render_filtered_args(args) }}
          <div class="mb-3">
            <label for="number_of_items_{{ print.id }}" class="form-label">Nombre dâ€™Ã©lÃ©ments</label>
            <input type="number" min="1" class="form-control" name="number_of_items" id="number_of_items_{{ print.id }}" value="{{ print.number_of_items or 1 }}">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-primary">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- MODAL AJOUT Ã€ UN GROUPE -->
<div class="modal fade" id="groupModal_{{ print.id }}" tabindex="-1" aria-labelledby="groupModalLabel_{{ print.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{{ url_for('assign_to_group', page=page,search=search, focus_id=print.id) }}">
        <div class="modal-header">
          <h5 class="modal-title" id="groupModalLabel_{{ print.id }}">Ajouter Ã  un groupe (Print #{{ print.id }})</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" name="print_id" value="{{ print.id }}">
{{ macros.render_filtered_args(args) }}

          <div class="mb-3">
            <label class="form-label" for="group_{{ print.id }}">CrÃ©er ou ajouter groupe</label>
            <select id="group_{{ print.id }}" name="group_id_or_name" class="form-control select2-ajax" style="width: 100%;" placeholder="Tapez pour rechercher ou crÃ©erâ€¦"></select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Assigner</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="adjustDurationModal_{{ print.id }}" tabindex="-1" aria-labelledby="adjustDurationModalLabel_{{ print.id }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form method="post" action="{{ url_for('adjust_duration') }}?page={{ page }}&search={{ search }}&focus_print_id={{ print.id }}">
      <input type="hidden" name="print_id" value="{{ print.id }}">
{{ macros.render_filtered_args(args) }}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="adjustDurationModalLabel_{{ print.id }}">ðŸ•’ Ajuster la durÃ©e</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="hours_{{ print.id }}" class="form-label">Heures</label>
            <input type="number" class="form-control" id="hours_{{ print.id }}" name="hours" min="0" step="0.01">
          </div>
          <div class="mb-3">
            <label for="minutes_{{ print.id }}" class="form-label">Minutes</label>
            <input type="number" class="form-control" id="minutes_{{ print.id }}" name="minutes" min="0" step="1">
          </div>
        </div>
       <button type="button" class="btn btn-primary"
        onclick="confirmAdjustDuration('{{ print.id }}')">
  âœ… Enregistrer
</button>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="changeStatusModal_{{ print.id }}" tabindex="-1" aria-labelledby="changeStatusModalLabel_{{ print.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <form method="post" action="{{ url_for('change_print_status') }}">
      <input type="hidden" name="print_id" value="{{ print.id }}">
{{ macros.render_filtered_args(args) }}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changeStatusModalLabel_{{ print.id }}">Changer le statut de lâ€™impression</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="status_{{ print.id }}" class="form-label">Statut</label>
            <select class="form-select" id="status_{{ print.id }}" name="new_status" required>
  <option value="SUCCESS" {% if print.status == 'SUCCESS' %}selected{% endif %}>ðŸŸ¢ SuccÃ¨s</option>
  <option value="TO_REDO" {% if print.status == 'TO_REDO' %}selected{% endif %}>ðŸŸ¡ Ã€ refaire</option>
  <option value="PARTIAL" {% if print.status == 'PARTIAL' %}selected{% endif %}>ðŸŸ  Partiel</option>
  <option value="FAILED" {% if print.status == 'FAILED' %}selected{% endif %}>ðŸ”´ Ã‰chec</option>
  <option value="IN_PROGRESS" {% if print.status == 'IN_PROGRESS' %}selected{% endif %}>ðŸ”µ En cours</option>
</select>
          </div>
          <div class="mb-3">
            <label for="status_note_{{ print.id }}" class="form-label">Note (facultatif)</label>
            <textarea class="form-control" id="status_note_{{ print.id }}" name="status_note" rows="2">{{ print.status_note or '' }}</textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">âœ… Enregistrer</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="soldModal_{{ print.id }}" tabindex="-1" aria-labelledby="soldModalLabel_{{ print.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <form method="post" action="{{ url_for('set_sold_price') }}">
      <input type="hidden" name="id" value="{{ print.id }}">
      <input type="hidden" name="is_group" value="0">
{{ macros.render_filtered_args(args) }}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="soldModalLabel_{{ print.id }}">ðŸ’¸ Marquer comme vendu (Print #{{ print.id }})</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="total_price_{{ print.id }}" class="form-label">Prix de vente ({{ currencysymbol }})</label>
            <input type="number" class="form-control" name="total_price" id="total_price_{{ print.id }}" step="0.01" min="0" required>
          </div>
          <div class="mb-3">
            <label for="sold_units_{{ print.id }}" class="form-label">Nombre dâ€™unitÃ©s vendues</label>
            <input type="number" class="form-control" name="sold_units" id="sold_units_{{ print.id }}" min="1" value="{{ print.number_of_items or 1 }}" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">âœ… Enregistrer</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        </div>
      </div>
    </form>
  </div>
</div>

{# --- Modal: CrÃ©er des objets (PRINT) ------------------------------------ #}
<div class="modal fade create-objects-modal"
     id="createObjectsModal_print_{{ print.id }}"
     tabindex="-1"
     aria-labelledby="createObjectsLabel_print_{{ print.id }}"
     data-source-type="print"
     data-source-id="{{ print.id }}">
  <div class="modal-dialog">
    <form class="modal-content create-objects-form">
      <div class="modal-header">
        <h5 class="modal-title" id="createObjectsLabel_print_{{ print.id }}">
          CrÃ©er des objets (print #{{ print.id }})
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2 small text-muted">
          Disponible : <span class="available-counter">â€”</span>
        </div>
        <label class="form-label">QuantitÃ© Ã  crÃ©er</label>
        <input type="number" class="form-control qty-input" name="qty" min="1" value="1" required>
		<div class="mb-3 mt-3">
          <label class="form-label" for="group_{{ print.id }}">CrÃ©er ou ajouter groupe (optionnel)</label>
          <select
            id="group_{{ print.id }}"
            name="objgroup_id_or_name"
            class="select2 select2-ajax select2-ajax-object"
            style="width: 100%;"
            placeholder="Tapez pour rechercher ou crÃ©erâ€¦"></select>
        </div>
        <input type="hidden" name="type" value="print">
        <input type="hidden" name="id" value="{{ print.id }}">
		{{ macros.render_filtered_args(args) }}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        <button type="submit" class="btn btn-success submit-btn">CrÃ©er</button>
      </div>
    </form>
  </div>
</div>


<div class="modal fade" id="uploadPhotoModal_{{ print.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" action="{{ url_for('upload_print_photo', print_id=print.id) }}" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title">ðŸ“¸ Ajouter une photo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <input class="form-control" type="file" name="photo" accept="image/*" required>
          <small class="text-muted">Lâ€™image sera stockÃ©e pour le print #{{ print.id }}</small>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Uploader</button>
        </div>
      </form>
    </div>
  </div>
</div>


<div class="modal fade" id="editDesignIdModal_{{ print.id }}" tabindex="-1" aria-labelledby="editDesignIdLabel_{{ print.id }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form class="modal-content" method="post" action="{{ url_for('set_design_id') }}">
      <div class="modal-header">
        <h5 class="modal-title" id="editDesignIdLabel_{{ print.id }}">Modifier lâ€™identifiant MakerWorld</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>

      <div class="modal-body">
        <input type="hidden" name="print_id" value="{{ print.id }}">
        {{ macros.render_filtered_args(args) }}

        <label for="design_id_input_{{ print.id }}" class="form-label small">Identifiant (ex: 123456)</label>
        <input
          type="text"
          class="form-control"
          id="design_id_input_{{ print.id }}"
          name="design_id"
          value="{{ print.design_id or '' }}"
          placeholder="Laisser vide pour effacer"
        >
        <div class="form-text">
          Sera utilisÃ© pour ouvrir <code>https://makerworld.com/fr/models/&lt;identifiant&gt;</code>.
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annuler</button>
        <button type="submit" class="btn btn-primary">Enregistrer</button>
      </div>
    </form>
  </div>
</div>